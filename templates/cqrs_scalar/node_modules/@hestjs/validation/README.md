# @hestjs/validation

HestJS éªŒè¯æ¨¡å—ï¼ŒåŸºäº TypeBox æä¾›å¼ºç±»å‹éªŒè¯åŠŸèƒ½ã€‚

## ç‰¹æ€§

- ğŸ”¥ åŸºäº TypeBox çš„ç±»å‹å®‰å…¨éªŒè¯
- ğŸ¯ è£…é¥°å™¨è¯­æ³•ï¼Œç®€æ´æ˜“ç”¨
- ğŸš€ è‡ªåŠ¨ç±»å‹æ¨æ–­å’Œè½¬æ¢
- ğŸ›¡ï¸ å†…ç½®å¸¸ç”¨éªŒè¯è§„åˆ™
- ğŸ“¦ è½»é‡çº§ï¼Œé›¶é¢å¤–ä¾èµ–
- âš¡ é«˜æ€§èƒ½éªŒè¯å¼•æ“

## å®‰è£…

```bash
npm install @hestjs/validation
# æˆ–è€…
yarn add @hestjs/validation
# æˆ–è€…
pnpm add @hestjs/validation
```

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç”¨æ³•

```typescript
import { IsString, IsNumber, IsEmail, IsOptional } from '@hestjs/validation';

class CreateUserDto {
  @IsString()
  name: string;

  @IsEmail()
  email: string;

  @IsNumber()
  @IsOptional()
  age?: number;
}

// åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨
import { Body, Controller, Post } from '@hestjs/core';

@Controller('/users')
export class UserController {
  @Post()
  async createUser(@Body() createUserDto: CreateUserDto) {
    // createUserDto å·²ç»è¢«è‡ªåŠ¨éªŒè¯
    return { message: 'User created', user: createUserDto };
  }
}
```

### è‡ªå®šä¹‰éªŒè¯

```typescript
import { IsCustom, ValidationUtils } from '@hestjs/validation';

class ProductDto {
  @IsString()
  name: string;

  @IsCustom((value) => value > 0, 'ä»·æ ¼å¿…é¡»å¤§äº0')
  price: number;
}
```

### éªŒè¯å·¥å…·ç±»

```typescript
import { ValidationUtils } from '@hestjs/validation';

// éªŒè¯å¯¹è±¡
try {
  const validatedUser = await ValidationUtils.validateObject(CreateUserDto, userData);
  console.log('éªŒè¯æˆåŠŸ:', validatedUser);
} catch (error) {
  console.log('éªŒè¯å¤±è´¥:', error.message);
}

// æ£€æŸ¥æ˜¯å¦æœ‰æ•ˆ
const isValid = await ValidationUtils.isValid(CreateUserDto, userData);

// è·å–éªŒè¯é”™è¯¯
const errors = await ValidationUtils.getValidationErrors(CreateUserDto, userData);

// æ‰¹é‡éªŒè¯
const { valid, errors: batchErrors } = await ValidationUtils.validateBatch(
  CreateUserDto, 
  [userData1, userData2, userData3]
);

// éƒ¨åˆ†éªŒè¯
const partialUser = await ValidationUtils.validatePartial(CreateUserDto, {
  name: 'John' // åªéªŒè¯æä¾›çš„å­—æ®µ
});
```

## å¯ç”¨è£…é¥°å™¨

### åŸºç¡€ç±»å‹éªŒè¯

- `@IsString()` - å­—ç¬¦ä¸²éªŒè¯
- `@IsNumber()` - æ•°å­—éªŒè¯
- `@IsBoolean()` - å¸ƒå°”å€¼éªŒè¯
- `@IsArray()` - æ•°ç»„éªŒè¯
- `@IsObject()` - å¯¹è±¡éªŒè¯

### å­—ç¬¦ä¸²éªŒè¯

- `@IsEmail()` - é‚®ç®±æ ¼å¼éªŒè¯
- `@IsUrl()` - URL æ ¼å¼éªŒè¯
- `@IsUuid()` - UUID æ ¼å¼éªŒè¯
- `@MinLength(min)` - æœ€å°é•¿åº¦
- `@MaxLength(max)` - æœ€å¤§é•¿åº¦
- `@Matches(pattern)` - æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…

### æ•°å­—éªŒè¯

- `@Min(min)` - æœ€å°å€¼
- `@Max(max)` - æœ€å¤§å€¼
- `@IsPositive()` - æ­£æ•°
- `@IsNegative()` - è´Ÿæ•°
- `@IsInt()` - æ•´æ•°

### æ—¥æœŸéªŒè¯

- `@IsDate()` - æ—¥æœŸéªŒè¯
- `@IsDateString()` - æ—¥æœŸå­—ç¬¦ä¸²éªŒè¯

### å…¶ä»–

- `@IsOptional()` - å¯é€‰å­—æ®µ
- `@IsEnum(enumObject)` - æšä¸¾éªŒè¯
- `@IsCustom(validator, message)` - è‡ªå®šä¹‰éªŒè¯

## é«˜çº§ç”¨æ³•

### åµŒå¥—å¯¹è±¡éªŒè¯

```typescript
class AddressDto {
  @IsString()
  street: string;

  @IsString()
  city: string;

  @IsString()
  @Matches(/^\d{5}$/)
  zipCode: string;
}

class UserDto {
  @IsString()
  name: string;

  @IsEmail()
  email: string;

  @ValidateNested()
  @Type(() => AddressDto)
  address: AddressDto;
}
```

### æ•°ç»„éªŒè¯

```typescript
class CreateUsersDto {
  @IsArray()
  @ValidateNested({ each: true })
  @Type(() => CreateUserDto)
  users: CreateUserDto[];
}
```

### æ¡ä»¶éªŒè¯

```typescript
class ConditionalDto {
  @IsString()
  type: 'email' | 'phone';

  @IsOptional()
  @IsEmail()
  @ValidateIf(o => o.type === 'email')
  email?: string;

  @IsOptional()
  @IsPhoneNumber()
  @ValidateIf(o => o.type === 'phone')
  phone?: string;
}
```

## é…ç½®é€‰é¡¹

### å…¨å±€é…ç½®

```typescript
import { ValidationModule } from '@hestjs/validation';

@Module({
  imports: [
    ValidationModule.forRoot({
      whitelist: true, // ç§»é™¤æœªè£…é¥°çš„å±æ€§
      forbidNonWhitelisted: true, // ç¦æ­¢éç™½åå•å±æ€§
      transform: true, // è‡ªåŠ¨ç±»å‹è½¬æ¢
      disableErrorMessages: false, // ç¦ç”¨é”™è¯¯æ¶ˆæ¯
      dismissDefaultMessages: false, // å¿½ç•¥é»˜è®¤æ¶ˆæ¯
      validationError: { target: false }, // é”™è¯¯å¯¹è±¡é…ç½®
    }),
  ],
})
export class AppModule {}
```

### ç®¡é“é…ç½®

```typescript
import { ValidationPipe } from '@hestjs/validation';

// åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸­ä½¿ç”¨
@Post()
@UsePipes(new ValidationPipe({
  transform: true,
  whitelist: true,
}))
async createUser(@Body() createUserDto: CreateUserDto) {
  return createUserDto;
}
```

## é”™è¯¯å¤„ç†

éªŒè¯é”™è¯¯ä¼šæŠ›å‡º `ValidationException`ï¼ŒåŒ…å«è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š

```typescript
try {
  await ValidationUtils.validateObject(CreateUserDto, invalidData);
} catch (error) {
  if (error instanceof ValidationException) {
    console.log('éªŒè¯é”™è¯¯:', error.getMessages());
    console.log('é”™è¯¯è¯¦æƒ…:', error.getErrors());
  }
}
```

## TypeScript æ”¯æŒ

å®Œå…¨æ”¯æŒ TypeScriptï¼Œæä¾›ç±»å‹å®‰å…¨çš„éªŒè¯ï¼š

```typescript
// è‡ªåŠ¨ç±»å‹æ¨æ–­
const user: CreateUserDto = await ValidationUtils.validateObject(CreateUserDto, data);

// ç”Ÿæˆ TypeBox Schema
const schema = ValidationUtils.generateSchema(CreateUserDto);
```

## ä¸ HestJS é›†æˆ

### è‡ªåŠ¨éªŒè¯

```typescript
import { Body, Controller, Post } from '@hestjs/core';
import { UseValidation } from '@hestjs/validation';

@Controller('/api')
@UseValidation() // å¯ç”¨è‡ªåŠ¨éªŒè¯
export class ApiController {
  @Post('/users')
  async createUser(@Body() userData: CreateUserDto) {
    // userData å·²è‡ªåŠ¨éªŒè¯
    return userData;
  }
}
```

### è‡ªå®šä¹‰éªŒè¯æ‹¦æˆªå™¨

```typescript
import { UseInterceptors } from '@hestjs/core';
import { ValidationInterceptor } from '@hestjs/validation';

@Controller('/api')
@UseInterceptors(ValidationInterceptor)
export class ApiController {
  // ...
}
```

## æ€§èƒ½

- åŸºäº TypeBox çš„é«˜æ€§èƒ½éªŒè¯å¼•æ“
- æ”¯æŒ JIT ç¼–è¯‘çš„éªŒè¯å‡½æ•°
- æœ€å°åŒ–è¿è¡Œæ—¶å¼€é”€
- æ”¯æŒç¼“å­˜éªŒè¯ç»“æœ

## è®¸å¯è¯

MIT

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## æ›´æ–°æ—¥å¿—

### v0.1.2
- æ–°å¢ ValidationUtils å·¥å…·ç±»
- æ”¯æŒæ‰¹é‡éªŒè¯å’Œéƒ¨åˆ†éªŒè¯
- ä¼˜åŒ–é”™è¯¯æ¶ˆæ¯æ ¼å¼
- æå‡éªŒè¯æ€§èƒ½

### v0.1.1
- ä¿®å¤ TypeBox å…¼å®¹æ€§é—®é¢˜
- ä¼˜åŒ–è£…é¥°å™¨å®ç°

### v0.1.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- åŸºç¡€éªŒè¯è£…é¥°å™¨
- TypeBox é›†æˆ
